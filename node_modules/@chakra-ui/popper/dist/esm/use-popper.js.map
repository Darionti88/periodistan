{"version":3,"sources":["../../src/use-popper.ts"],"names":["filterUndefined","createPopper","useCallback","useEffect","useMemo","useRef","popperModifiers","getEventListenerOptions","defaultProps","placement","strategy","flip","gutter","arrowPadding","preventOverflow","eventListeners","modifiers","boundary","usePopper","props","opts","Object","assign","placementProp","offset","matchWidth","reference","popper","instanceRef","cleanup","setupPopper","current","concat","innerArrow","positionArrow","transformOrigin","enabled","name","options","padding","forceUpdate","destroy","update","referenceRef","node","popperRef"],"mappings":";;AAAA,SAASA,eAAT,QAAgC,kBAAhC;AACA,SACEC,YADF,QAMO,gBANP;AAOA,SAASC,WAAT,EAAsBC,SAAtB,EAAiCC,OAAjC,EAA0CC,MAA1C,QAAwD,OAAxD;AACA,OAAO,KAAKC,eAAZ,MAAiC,aAAjC;AACA,SAASC,uBAAT,QAAwC,SAAxC;AAkBA,IAAMC,YAA4B,GAAG;AACnCC,EAAAA,SAAS,EAAE,QADwB;AAEnCC,EAAAA,QAAQ,EAAE,UAFyB;AAGnCC,EAAAA,IAAI,EAAE,IAH6B;AAInCC,EAAAA,MAAM,EAAE,CAJ2B;AAKnCC,EAAAA,YAAY,EAAE,CALqB;AAMnCC,EAAAA,eAAe,EAAE,IANkB;AAOnCC,EAAAA,cAAc,EAAE,IAPmB;AAQnCC,EAAAA,SAAS,EAAE,EARwB;AASnCC,EAAAA,QAAQ,EAAE;AATyB,CAArC;AAYA,OAAO,SAASC,SAAT,CAAmBC,KAAnB,EAA+C;AAAA,MAA5BA,KAA4B;AAA5BA,IAAAA,KAA4B,GAAJ,EAAI;AAAA;;AACpD,MAAMC,IAAI,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBd,YAAlB,EAAgCR,eAAe,CAACmB,KAAD,CAA/C,CAAb;AACA,MAAM;AACJH,IAAAA,SAAS,GAAG,EADR;AAEJP,IAAAA,SAAS,EAAEc,aAFP;AAGJb,IAAAA,QAHI;AAIJG,IAAAA,YAJI;AAKJE,IAAAA,cALI;AAMJS,IAAAA,MANI;AAOJZ,IAAAA,MAPI;AAQJD,IAAAA,IARI;AASJM,IAAAA,QATI;AAUJH,IAAAA,eAVI;AAWJW,IAAAA;AAXI,MAYFL,IAZJ;AAcA,MAAMM,SAAS,GAAGrB,MAAM,CAAkC,IAAlC,CAAxB;AACA,MAAMsB,MAAM,GAAGtB,MAAM,CAAqB,IAArB,CAArB;AACA,MAAMuB,WAAW,GAAGvB,MAAM,CAAkB,IAAlB,CAA1B;AAEA,MAAMwB,OAAO,GAAGxB,MAAM,CAAC,MAAM,CAAE,CAAT,CAAtB;AAEA,MAAMyB,WAAW,GAAG5B,WAAW,CAAC,MAAM;AACpC,QAAI,CAACwB,SAAS,CAACK,OAAX,IAAsB,CAACJ,MAAM,CAACI,OAAlC,EAA2C;AAC3CF,IAAAA,OAAO,CAACE,OAAR,oBAAAF,OAAO,CAACE,OAAR;AAEAH,IAAAA,WAAW,CAACG,OAAZ,GAAsB9B,YAAY,CAACyB,SAAS,CAACK,OAAX,EAAoBJ,MAAM,CAACI,OAA3B,EAAoC;AACpEtB,MAAAA,SAAS,EAAEc,aADyD;AAEpEP,MAAAA,SAAS,EAAEA,SAAS,CAACgB,MAAV,CAAiB,CAC1B1B,eAAe,CAAC2B,UADU,EAE1B3B,eAAe,CAAC4B,aAFU,EAG1B5B,eAAe,CAAC6B,eAHU,eAIrB7B,eAAe,CAACmB,UAJK;AAIOW,QAAAA,OAAO,EAAE,CAAC,CAACX;AAJlB;AAMxBY,QAAAA,IAAI,EAAE;AANkB,SAOrB9B,uBAAuB,CAACQ,cAAD,CAPF,GAS1B;AACEsB,QAAAA,IAAI,EAAE,OADR;AAEEC,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE1B;AAAX;AAFX,OAT0B,EAa1B;AACEwB,QAAAA,IAAI,EAAE,QADR;AAEEC,QAAAA,OAAO,EAAE;AACPd,UAAAA,MAAM,EAAEA,MAAF,WAAEA,MAAF,GAAY,CAAC,CAAD,EAAIZ,MAAJ;AADX;AAFX,OAb0B,EAmB1B;AACEyB,QAAAA,IAAI,EAAE,MADR;AAEED,QAAAA,OAAO,EAAE,CAAC,CAACzB,IAFb;AAGE2B,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE;AAAX;AAHX,OAnB0B,EAwB1B;AACEF,QAAAA,IAAI,EAAE,iBADR;AAEED,QAAAA,OAAO,EAAE,CAAC,CAACtB,eAFb;AAGEwB,QAAAA,OAAO,EAAE;AAAErB,UAAAA;AAAF;AAHX,OAxB0B,CAAjB,CAFyD;AAgCpEP,MAAAA;AAhCoE,KAApC,CAAlC,CAJoC,CAuCpC;;AACAkB,IAAAA,WAAW,CAACG,OAAZ,CAAoBS,WAApB;AAEAX,IAAAA,OAAO,CAACE,OAAR,GAAkBH,WAAW,CAACG,OAAZ,CAAoBU,OAAtC;AACD,GA3C8B,EA2C5B,CACDlB,aADC,EAEDP,SAFC,EAGDS,UAHC,EAIDV,cAJC,EAKDF,YALC,EAMDW,MANC,EAODZ,MAPC,EAQDD,IARC,EASDG,eATC,EAUDG,QAVC,EAWDP,QAXC,CA3C4B,CAA/B;AAyDAP,EAAAA,SAAS,CAAC,MAAM;AACd,WAAO,MAAM;AAAA;;AACX,8BAAAyB,WAAW,CAACG,OAAZ,0CAAqBU,OAArB;AACAb,MAAAA,WAAW,CAACG,OAAZ,GAAsB,IAAtB;AACD,KAHD;AAID,GALQ,EAKN,EALM,CAAT;AAOA,SAAO3B,OAAO,CACZ;AAAA;;AAAA,WAAO;AACLsC,MAAAA,MAAM,2BAAEd,WAAW,CAACG,OAAd,qBAAE,sBAAqBW,MADxB;AAELF,MAAAA,WAAW,2BAAEZ,WAAW,CAACG,OAAd,qBAAE,sBAAqBS,WAF7B;AAGLG,MAAAA,YAAY,EAAuCC,IAArC,IAAwD;AACpElB,QAAAA,SAAS,CAACK,OAAV,GAAoBa,IAApB;AACAd,QAAAA,WAAW;AACZ,OANI;AAOLe,MAAAA,SAAS,EAA0BD,IAAxB,IAA2C;AACpDjB,QAAAA,MAAM,CAACI,OAAP,GAAiBa,IAAjB;AACAd,QAAAA,WAAW;AACZ;AAVI,KAAP;AAAA,GADY,EAaZ,CAACA,WAAD,CAbY,CAAd;AAeD","sourcesContent":["import { filterUndefined } from \"@chakra-ui/utils\"\nimport {\n  createPopper,\n  Instance,\n  Modifier,\n  Placement,\n  VirtualElement,\n} from \"@popperjs/core\"\nimport { useCallback, useEffect, useMemo, useRef } from \"react\"\nimport * as popperModifiers from \"./modifiers\"\nimport { getEventListenerOptions } from \"./utils\"\n\nexport type { Placement }\n\nexport interface UsePopperProps {\n  offset?: [x: number, y: number]\n  gutter?: number\n  preventOverflow?: boolean\n  flip?: boolean\n  matchWidth?: boolean\n  boundary?: \"clippingParents\" | \"scrollParent\" | HTMLElement\n  eventListeners?: boolean | { scroll?: boolean; resize?: boolean }\n  arrowPadding?: number\n  strategy?: \"absolute\" | \"fixed\"\n  placement?: Placement\n  modifiers?: Array<Partial<Modifier<string, any>>>\n}\n\nconst defaultProps: UsePopperProps = {\n  placement: \"bottom\",\n  strategy: \"absolute\",\n  flip: true,\n  gutter: 8,\n  arrowPadding: 8,\n  preventOverflow: true,\n  eventListeners: true,\n  modifiers: [],\n  boundary: \"clippingParents\",\n}\n\nexport function usePopper(props: UsePopperProps = {}) {\n  const opts = Object.assign({}, defaultProps, filterUndefined(props))\n  const {\n    modifiers = [],\n    placement: placementProp,\n    strategy,\n    arrowPadding,\n    eventListeners,\n    offset,\n    gutter,\n    flip,\n    boundary,\n    preventOverflow,\n    matchWidth,\n  } = opts\n\n  const reference = useRef<Element | VirtualElement | null>(null)\n  const popper = useRef<HTMLElement | null>(null)\n  const instanceRef = useRef<Instance | null>(null)\n\n  const cleanup = useRef(() => {})\n\n  const setupPopper = useCallback(() => {\n    if (!reference.current || !popper.current) return\n    cleanup.current?.()\n\n    instanceRef.current = createPopper(reference.current, popper.current, {\n      placement: placementProp,\n      modifiers: modifiers.concat([\n        popperModifiers.innerArrow,\n        popperModifiers.positionArrow,\n        popperModifiers.transformOrigin,\n        { ...popperModifiers.matchWidth, enabled: !!matchWidth },\n        {\n          name: \"eventListeners\",\n          ...getEventListenerOptions(eventListeners),\n        },\n        {\n          name: \"arrow\",\n          options: { padding: arrowPadding },\n        },\n        {\n          name: \"offset\",\n          options: {\n            offset: offset ?? [0, gutter],\n          },\n        },\n        {\n          name: \"flip\",\n          enabled: !!flip,\n          options: { padding: 8 },\n        },\n        {\n          name: \"preventOverflow\",\n          enabled: !!preventOverflow,\n          options: { boundary },\n        },\n      ]),\n      strategy,\n    })\n\n    // force update one-time to fix any positioning issues\n    instanceRef.current.forceUpdate()\n\n    cleanup.current = instanceRef.current.destroy\n  }, [\n    placementProp,\n    modifiers,\n    matchWidth,\n    eventListeners,\n    arrowPadding,\n    offset,\n    gutter,\n    flip,\n    preventOverflow,\n    boundary,\n    strategy,\n  ])\n\n  useEffect(() => {\n    return () => {\n      instanceRef.current?.destroy()\n      instanceRef.current = null\n    }\n  }, [])\n\n  return useMemo(\n    () => ({\n      update: instanceRef.current?.update,\n      forceUpdate: instanceRef.current?.forceUpdate,\n      referenceRef: <T extends Element | VirtualElement>(node: T | null) => {\n        reference.current = node\n        setupPopper()\n      },\n      popperRef: <T extends HTMLElement>(node: T | null) => {\n        popper.current = node\n        setupPopper()\n      },\n    }),\n    [setupPopper],\n  )\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>\n"],"file":"use-popper.js"}